import{r as a,e as w,c as m,h as x,j as e,L as C}from"./index-B2BqGpJW.js";import{s as n}from"./toast-DJ39ryeq.js";const b=["Pending","Confirmed","InProgress","Completed","Cancelled","Expired","Awaiting Payment"],j={0:"#f59e0b",1:"#10b981",2:"#6366f1",3:"#22c55e",4:"#ef4444",5:"#9ca3af",6:"#8b5cf6"},B=["booking.requested","payment.completed","booking.cancelled","booking.checkin","booking.checkout"];function T(){const[p,d]=a.useState([]),[N,g]=a.useState(!0),[c,y]=a.useState("0"),[i,l]=a.useState(null),[v,h]=a.useState(""),[o,u]=a.useState(null),{subscribeToRefresh:f}=w(),r=a.useCallback(async()=>{g(!0);try{const s=c?{status:c}:{},t=await m.getVendorBookings(s);if(t.success&&t.data){const S=Array.isArray(t.data)?t.data:t.data.bookings||t.data.items||[];d(S)}else d([])}catch(s){n.error(x(s,"Failed to load bookings")),d([])}g(!1)},[c]);a.useEffect(()=>{r()},[r]),a.useEffect(()=>f("VendorBookings",B,()=>{console.log("ðŸ”„ VendorBookings: Auto-refreshing due to notification"),r()}),[f,r]);const k=async s=>{l(s);try{const t=await m.approveBooking(s);t.success?(n.success("Booking approved successfully!"),r()):n.error(t.message||"Failed to approve booking")}catch(t){n.error(x(t,"Failed to approve booking"))}l(null)},R=async s=>{l(s);try{const t=await m.rejectBooking(s,v);t.success?(n.success("Booking rejected"),u(null),h(""),r()):n.error(t.message||"Failed to reject booking")}catch(t){n.error(x(t,"Failed to reject booking"))}l(null)};return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex-between mb-3",children:[e.jsx("h1",{children:"Booking Requests"}),e.jsxs("select",{className:"form-select",style:{width:"auto"},value:c,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"All Bookings"}),b.map((s,t)=>e.jsx("option",{value:t,children:s},t))]})]}),N?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):p.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“‹"}),e.jsx("h3",{children:"No booking requests"}),e.jsx("p",{children:c==="0"?"No pending requests to review":"No bookings found with this status"})]}):e.jsx("div",{className:"grid",style:{gap:"1rem"},children:p.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"card-title",children:s.parkingSpaceTitle}),e.jsxs("div",{className:"card-subtitle",children:["Requested by: ",e.jsx("strong",{children:s.userName})]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("span",{className:"parking-tag",style:{background:`${j[s.status]}20`,color:j[s.status],border:`1px solid ${j[s.status]}50`},children:b[s.status]}),e.jsxs("div",{className:"parking-price mt-1",children:["â‚¹",s.totalAmount]})]})]}),e.jsxs("div",{className:"grid grid-4 mt-2",style:{fontSize:"0.9rem"},children:[e.jsxs("div",{children:[e.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Reference"}),e.jsx("div",{children:s.bookingReference})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Start"}),e.jsx("div",{children:new Date(s.startDateTime).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"var(--color-text-muted)"},children:"End"}),e.jsx("div",{children:new Date(s.endDateTime).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Vehicle"}),e.jsx("div",{children:s.vehicleNumber||"Not specified"})]})]}),s.status===0&&e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>k(s.id),disabled:i===s.id,children:i===s.id?"Processing...":"âœ“ Approve"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>u(s.id),disabled:i===s.id,children:"âœ— Reject"})]}),s.status!==0&&e.jsx(C,{to:`/parking/${s.parkingSpaceId}`,className:"btn btn-secondary mt-2",children:"View Parking"})]},s.id))}),o&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"card",style:{maxWidth:"400px",width:"100%"},children:[e.jsx("h3",{className:"card-title",children:"Reject Booking"}),e.jsx("p",{className:"card-subtitle mb-2",children:"Please provide a reason for rejection (optional):"}),e.jsx("textarea",{className:"form-input",rows:"3",placeholder:"Reason for rejection...",value:v,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>R(o),disabled:i===o,children:i===o?"Rejecting...":"Confirm Reject"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(null),h("")},children:"Cancel"})]})]})})]})})}export{T as default};
