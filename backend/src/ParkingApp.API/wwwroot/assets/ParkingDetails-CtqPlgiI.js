import{d as O,a as q,u as U,r as i,c as h,j as e,g as f,h as b}from"./index-B2BqGpJW.js";import{s as d}from"./toast-DJ39ryeq.js";const W=["Open","Covered","Garage","Street","Underground"],H=["Car","Motorcycle","SUV","Truck","Van","Electric"],Y=["Hourly","Daily","Weekly","Monthly"],$=["Credit Card","Debit Card","UPI","Net Banking","Wallet","Cash"],F="https://parkeaseapp.azurewebsites.net";function G(){const{id:m}=O(),T=q(),{isAuthenticated:k,user:L}=U(),[r,S]=i.useState(null),[x,P]=i.useState([]),[D,w]=i.useState(!0),[l,j]=i.useState(""),[t,c]=i.useState({startDateTime:"",endDateTime:"",pricingType:0,vehicleType:0,vehicleNumber:"",vehicleModel:"",discountCode:""}),[n,C]=i.useState(null),[u,g]=i.useState(!1),[o,v]=i.useState(null),[B,N]=i.useState(!1),[p,R]=i.useState(null),[y,I]=i.useState(0);i.useEffect(()=>{A()},[m]),i.useEffect(()=>{t.startDateTime&&t.endDateTime&&r&&E()},[t.startDateTime,t.endDateTime,t.pricingType,t.discountCode]);const A=async()=>{try{const s=await h.getParkingById(m);s.success&&s.data?S(s.data):j("Parking space not found");const a=await h.getReviews(m);a.success&&a.data&&P(a.data)}catch{j("Failed to load parking details")}w(!1)},E=async()=>{if(!(!t.startDateTime||!t.endDateTime))try{const s=await h.calculatePrice({parkingSpaceId:m,startDateTime:new Date(t.startDateTime).toISOString(),endDateTime:new Date(t.endDateTime).toISOString(),pricingType:t.pricingType,discountCode:t.discountCode||null});s.success&&s.data&&C(s.data)}catch(s){console.error("Price calculation error:",s)}},M=async s=>{if(s.preventDefault(),!k){T("/login");return}g(!0);try{const a=await h.createBooking({parkingSpaceId:m,startDateTime:new Date(t.startDateTime).toISOString(),endDateTime:new Date(t.endDateTime).toISOString(),pricingType:t.pricingType,vehicleType:t.vehicleType,vehicleNumber:t.vehicleNumber||null,vehicleModel:t.vehicleModel||null,discountCode:t.discountCode||null});a.success&&a.data?(R(a.data),v({reference:a.data.bookingReference,message:"Booking request submitted! Waiting for owner approval.",isPending:!0}),d.success("Booking request submitted! Waiting for owner approval.")):d.error(f(a))}catch(a){d.error(b(a,"Booking failed"))}g(!1)},z=async()=>{g(!0);try{const s=await h.processPayment({bookingId:p.id,paymentMethod:y});s.success&&s.data?.success?(v({reference:p.bookingReference,message:"Payment successful! Your booking is confirmed."}),N(!1),d.success("Payment successful! Your booking is confirmed.")):d.error(f(s.data||s))}catch(s){d.error(b(s,"Payment failed"))}g(!1)};return D?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container loading",children:e.jsx("div",{className:"spinner"})})}):l&&!r?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"alert alert-error",children:l})})}):e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[o&&e.jsxs("div",{className:`alert ${o.isPending?"alert-warning":"alert-success"} mb-2`,style:o.isPending?{background:"rgba(245, 158, 11, 0.15)",borderColor:"#f59e0b"}:{},children:[e.jsx("strong",{children:o.message}),e.jsx("br",{}),"Booking Reference: ",e.jsx("strong",{children:o.reference}),o.isPending&&e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem"},children:"The parking owner will review your request. Once approved, you can proceed with payment from your bookings page."})]}),e.jsxs("div",{className:"grid",style:{gridTemplateColumns:"1fr 400px",gap:"2rem"},children:[e.jsxs("div",{children:[r.imageUrls&&r.imageUrls.length>0?e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:r.imageUrls.map((s,a)=>e.jsx("img",{src:`${F}${s}`,alt:`${r.title} - ${a+1}`,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"var(--radius-md)",cursor:"pointer"},loading:"lazy"},a))})}):e.jsx("div",{className:"parking-image",style:{height:"300px",marginBottom:"1.5rem",fontSize:"5rem"},children:"ðŸ…¿ï¸"}),e.jsx("h1",{style:{marginBottom:"0.5rem"},children:r.title}),e.jsxs("div",{className:"parking-location",style:{fontSize:"1.1rem"},children:["ðŸ“ ",r.address,", ",r.city,", ",r.state]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"parking-tag",children:W[r.parkingType]}),e.jsxs("span",{className:"parking-tag",children:[r.totalSpots," Total Spots"]}),e.jsxs("span",{className:"parking-tag",children:[r.availableSpots," Available"]}),r.is24Hours&&e.jsx("span",{className:"parking-tag",children:"24/7"})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("h3",{className:"card-title",children:"Description"}),e.jsx("p",{children:r.description})]}),e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Pricing"}),e.jsxs("div",{className:"grid grid-4",style:{marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",r.hourlyRate]}),e.jsx("div",{className:"stat-label",children:"Per Hour"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",r.dailyRate]}),e.jsx("div",{className:"stat-label",children:"Per Day"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",r.weeklyRate]}),e.jsx("div",{className:"stat-label",children:"Per Week"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",r.monthlyRate]}),e.jsx("div",{className:"stat-label",children:"Per Month"})]})]})]}),r.amenities?.length>0&&e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Amenities"}),e.jsx("div",{className:"flex gap-1 mt-1",style:{flexWrap:"wrap"},children:r.amenities.map(s=>e.jsx("span",{className:"parking-tag",children:s},s))})]}),r.specialInstructions&&e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Special Instructions"}),e.jsx("p",{children:r.specialInstructions})]}),e.jsxs("div",{className:"card mt-2",children:[e.jsxs("h3",{className:"card-title",children:["Reviews (",r.totalReviews,")",e.jsxs("span",{className:"rating",style:{marginLeft:"1rem"},children:["â­ ",r.averageRating?.toFixed(1)||"No ratings"]})]}),x.length===0?e.jsx("p",{className:"card-subtitle mt-1",children:"No reviews yet"}):x.map(s=>e.jsxs("div",{style:{borderTop:"1px solid var(--color-border)",paddingTop:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"flex-between",children:[e.jsx("strong",{children:s.userName}),e.jsxs("span",{className:"rating",children:["â­ ",s.rating]})]}),s.title&&e.jsx("p",{style:{fontWeight:500,marginTop:"0.5rem"},children:s.title}),s.comment&&e.jsx("p",{className:"card-subtitle",children:s.comment}),s.ownerResponse&&e.jsxs("div",{style:{background:"var(--color-bg-glass)",padding:"0.75rem",borderRadius:"var(--radius-sm)",marginTop:"0.5rem"},children:[e.jsx("small",{children:"Owner Response:"}),e.jsx("p",{children:s.ownerResponse})]})]},s.id))]})]}),e.jsx("div",{children:B?e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Complete Payment"}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Booking Reference"}),e.jsx("strong",{children:p.bookingReference})]}),e.jsxs("div",{className:"price-row total",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["â‚¹",p.totalAmount]})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"form-label",children:"Payment Method"}),e.jsx("select",{className:"form-select",value:y,onChange:s=>I(parseInt(s.target.value)),children:$.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),l&&e.jsx("div",{className:"alert alert-error",children:l}),e.jsx("button",{className:"btn btn-primary btn-full mt-2",onClick:z,disabled:u,children:u?"Processing...":`Pay â‚¹${p.totalAmount}`}),e.jsx("button",{className:"btn btn-secondary btn-full mt-1",onClick:()=>N(!1),children:"Cancel"})]}):e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Book This Space"}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Start Date & Time"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:t.startDateTime,onChange:s=>c(a=>({...a,startDateTime:s.target.value})),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"End Date & Time"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:t.endDateTime,onChange:s=>c(a=>({...a,endDateTime:s.target.value})),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Pricing Type"}),e.jsx("select",{className:"form-select",value:t.pricingType,onChange:s=>c(a=>({...a,pricingType:parseInt(s.target.value)})),children:Y.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Vehicle Type"}),e.jsx("select",{className:"form-select",value:t.vehicleType,onChange:s=>c(a=>({...a,vehicleType:parseInt(s.target.value)})),children:H.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Vehicle Number (Optional)"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"e.g., MH12AB1234",value:t.vehicleNumber,onChange:s=>c(a=>({...a,vehicleNumber:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Discount Code"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Enter code",value:t.discountCode,onChange:s=>c(a=>({...a,discountCode:s.target.value}))})]}),n&&e.jsxs("div",{style:{borderTop:"1px solid var(--color-border)",paddingTop:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"price-row",children:[e.jsxs("span",{children:["Base (",n.duration," ",n.durationUnit,")"]}),e.jsxs("span",{children:["â‚¹",n.baseAmount]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Tax (18%)"}),e.jsxs("span",{children:["â‚¹",n.taxAmount]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Service Fee"}),e.jsxs("span",{children:["â‚¹",n.serviceFee]})]}),n.discountAmount>0&&e.jsxs("div",{className:"price-row",style:{color:"var(--color-success)"},children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-â‚¹",n.discountAmount]})]}),e.jsxs("div",{className:"price-row total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["â‚¹",n.totalAmount]})]})]}),l&&e.jsx("div",{className:"alert alert-error",children:l}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-full mt-2",disabled:u||!n,children:u?"Submitting Request...":"Request Booking"})]})]})})]})]})})}export{G as default};
