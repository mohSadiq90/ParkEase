import{u as j,r as i,e as u,c as d,j as s,L as n}from"./index-B2BqGpJW.js";const N=["Pending","Confirmed","InProgress","Completed","Cancelled","NoShow","Expired"],b=["booking.requested","booking.approved","booking.rejected","booking.cancelled","payment.completed","booking.checkin","booking.checkout"];function k(){const{user:o,isVendor:t,isMember:l}=j(),[a,m]=i.useState(null),[h,x]=i.useState(!0),{subscribeToRefresh:c}=u(),r=i.useCallback(async()=>{try{const e=t?await d.getVendorDashboard():await d.getMemberDashboard();e.success&&e.data&&m(e.data)}catch(e){console.error("Dashboard error:",e)}x(!1)},[t]);return i.useEffect(()=>{r()},[r]),i.useEffect(()=>c("Dashboard",b,()=>{console.log("ðŸ”„ Dashboard: Auto-refreshing due to notification"),r()}),[c,r]),h?s.jsx("div",{className:"page",children:s.jsx("div",{className:"container loading",children:s.jsx("div",{className:"spinner"})})}):s.jsx("div",{className:"page",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"dashboard-header flex-between",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"dashboard-title",children:["Welcome, ",o?.firstName,"!"]}),s.jsx("p",{className:"card-subtitle",children:t?"Vendor Dashboard":"Member Dashboard"})]}),t&&s.jsx(n,{to:"/vendor/listings",className:"btn btn-primary",children:"+ Add Parking Space"})]}),s.jsx("div",{className:"grid grid-4 mt-3",children:t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"card stat-card",children:[s.jsx("div",{className:"stat-value",children:a?.totalParkingSpaces||0}),s.jsx("div",{className:"stat-label",children:"Total Listings"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsx("div",{className:"stat-value",children:a?.activeBookings||0}),s.jsx("div",{className:"stat-label",children:"Active Bookings"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsxs("div",{className:"stat-value",children:["â‚¹",a?.monthlyEarnings?.toFixed(0)||0]}),s.jsx("div",{className:"stat-label",children:"Monthly Earnings"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsxs("div",{className:"stat-value",children:["â­ ",a?.averageRating?.toFixed(1)||"N/A"]}),s.jsx("div",{className:"stat-label",children:"Average Rating"})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"card stat-card",children:[s.jsx("div",{className:"stat-value",children:a?.totalBookings||0}),s.jsx("div",{className:"stat-label",children:"Total Bookings"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsx("div",{className:"stat-value",children:a?.activeBookings||0}),s.jsx("div",{className:"stat-label",children:"Active Bookings"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsx("div",{className:"stat-value",children:a?.completedBookings||0}),s.jsx("div",{className:"stat-label",children:"Completed"})]}),s.jsxs("div",{className:"card stat-card",children:[s.jsxs("div",{className:"stat-value",children:["â‚¹",a?.totalSpent?.toFixed(0)||0]}),s.jsx("div",{className:"stat-label",children:"Total Spent"})]})]})}),t&&a?.earningsChart&&s.jsxs("div",{className:"card mt-3",children:[s.jsx("h3",{className:"card-title",children:"Weekly Earnings"}),s.jsx("div",{className:"flex gap-1 mt-2",style:{alignItems:"flex-end",height:"200px"},children:a.earningsChart.map((e,g)=>s.jsxs("div",{style:{flex:1,textAlign:"center"},children:[s.jsx("div",{style:{height:`${Math.max(10,e.amount/Math.max(...a.earningsChart.map(v=>v.amount||1))*150)}px`,background:"var(--gradient-primary)",borderRadius:"var(--radius-sm)",marginBottom:"0.5rem"}}),s.jsx("small",{style:{color:"var(--color-text-secondary)"},children:e.day})]},g))})]}),s.jsxs("div",{className:"card mt-3",children:[s.jsx("h3",{className:"card-title mb-2",children:l?"Upcoming Bookings":"Recent Bookings"}),!a?.upcomingBookings?.length&&!a?.recentBookings?.length?s.jsx("p",{className:"card-subtitle",children:"No bookings to display"}):s.jsx("div",{children:(l?a?.upcomingBookings:a?.recentBookings)?.map(e=>s.jsxs("div",{className:"flex-between",style:{padding:"1rem",borderBottom:"1px solid var(--color-border)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:e.parkingSpaceTitle}),s.jsxs("div",{className:"card-subtitle",children:[new Date(e.startDateTime).toLocaleDateString()," -"," ",new Date(e.endDateTime).toLocaleDateString()]}),s.jsxs("small",{children:["Ref: ",e.bookingReference]})]}),s.jsxs("div",{style:{textAlign:"right"},children:[s.jsx("div",{className:"parking-tag",style:{background:e.status===1?"rgba(16, 185, 129, 0.2)":e.status===4?"rgba(239, 68, 68, 0.2)":"rgba(99, 102, 241, 0.2)"},children:N[e.status]}),s.jsxs("div",{style:{marginTop:"0.5rem",fontWeight:600},children:["â‚¹",e.totalAmount]})]})]},e.id))}),s.jsx(n,{to:"/bookings",className:"btn btn-secondary mt-2",children:"View All Bookings â†’"})]})]})})}export{k as default};
