import{r as c,e as E,c as d,h as m,j as s,L as N}from"./index-B2BqGpJW.js";import{s as t}from"./toast-DJ39ryeq.js";class A{constructor(i){this.options=i}open(){console.log("Mock Razorpay Checkout Opened",this.options),setTimeout(()=>{if(window.confirm(`Mock Payment Gateway

Payable Amount: â‚¹${this.options.amount/100}
Order ID: ${this.options.order_id}

Click OK to simulate SUCCESS.
Click Cancel to simulate FAILURE.`)){const l={razorpay_payment_id:`pay_mock_${Date.now()}`,razorpay_order_id:this.options.order_id,razorpay_signature:"mock_signature_valid"};console.log("Payment Success",l),this.options.handler&&this.options.handler(l)}else{const l={code:"BAD_REQUEST_ERROR",description:"Payment processing cancelled by user",source:"customer",step:"payment_authentication",reason:"payment_cancelled",metadata:{order_id:this.options.order_id,payment_id:null}};console.log("Payment Failed",l),alert("Payment Failed/Cancelled")}},500)}}const _=["Pending","Confirmed","InProgress","Completed","Cancelled","Expired","Awaiting Payment"],f={0:"#f59e0b",1:"#10b981",2:"#6366f1",3:"#22c55e",4:"#ef4444",5:"#9ca3af",6:"#8b5cf6"},z=["booking.approved","booking.rejected","payment.completed","booking.checkin","booking.checkout"];function O(){const[p,i]=c.useState([]),[l,g]=c.useState(!0),[u,S]=c.useState(""),[o,j]=c.useState(null),{subscribeToRefresh:v}=E(),r=c.useCallback(async()=>{g(!0);try{const e=u?{status:u}:{},a=await d.getMyBookings(e);if(a.success&&a.data){const n=Array.isArray(a.data)?a.data:a.data.bookings||a.data.items||[];i(n)}else i([])}catch(e){t.error(m(e,"Failed to load bookings")),i([])}g(!1)},[u]);c.useEffect(()=>{r()},[r]),c.useEffect(()=>v("MyBookings",z,()=>{console.log("ðŸ”„ MyBookings: Auto-refreshing due to notification"),r()}),[v,r]);const y=async e=>{if(window.confirm("Are you sure you want to cancel this booking?")){j(e);try{const a=await d.cancelBooking(e,"User requested cancellation");a.success?(t.success("Booking cancelled successfully"),r()):t.error(a.message||"Cancel failed")}catch(a){t.error(m(a,"Failed to cancel booking"))}j(null)}},w=async e=>{try{const a=await d.checkIn(e);a.success?(t.success("Checked in successfully"),r()):t.error(a.message||"Check-in failed")}catch(a){t.error(m(a,"Failed to check in"))}},b=async e=>{try{const a=await d.checkOut(e);a.success?(t.success("Checked out successfully"),r()):t.error(a.message||"Check-out failed")}catch(a){t.error(m(a,"Failed to check out"))}},[C,k]=c.useState(null),P=async(e,a)=>{k(e);try{const n=await d.createRazorpayOrder(e);if(!n.success)throw new Error(n.message||"Failed to create payment order");const R={key:"test_key_id",amount:a*100,currency:"INR",name:"ParkEase",description:"Payment for Booking",order_id:n.data,handler:async x=>{try{const h=await d.verifyRazorpayPayment({bookingId:e,razorpayPaymentId:x.razorpay_payment_id,razorpayOrderId:x.razorpay_order_id,razorpaySignature:x.razorpay_signature});h.success?(t.success("Payment successful"),r()):t.error(h.message||"Payment verification failed")}catch(h){t.error(m(h,"Payment verification failed"))}},prefill:{name:"ParkEase User",email:"user@example.com",contact:"9999999999"},theme:{color:"#3399cc"}};new A(R).open()}catch(n){t.error(m(n,"Failed to initiate payment"))}finally{k(null)}};return s.jsx("div",{className:"page",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"flex-between mb-3",children:[s.jsx("h1",{children:"My Bookings"}),s.jsxs("select",{className:"form-select",style:{width:"auto"},value:u,onChange:e=>S(e.target.value),children:[s.jsx("option",{value:"",children:"All Bookings"}),_.map((e,a)=>s.jsx("option",{value:a,children:e},a))]})]}),l?s.jsx("div",{className:"loading",children:s.jsx("div",{className:"spinner"})}):p.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-icon",children:"ðŸ“‹"}),s.jsx("h3",{children:"No bookings found"}),s.jsx("p",{children:"Start by searching for parking spaces"}),s.jsx(N,{to:"/search",className:"btn btn-primary mt-2",children:"Find Parking"})]}):s.jsx("div",{className:"grid",style:{gap:"1rem"},children:p.map(e=>s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"card-title",children:e.parkingSpaceTitle}),s.jsxs("div",{className:"parking-location",children:["ðŸ“ ",e.parkingSpaceAddress]})]}),s.jsxs("div",{style:{textAlign:"right"},children:[s.jsx("span",{className:"parking-tag",style:{background:`${f[e.status]}20`,color:f[e.status],border:`1px solid ${f[e.status]}50`},children:_[e.status]}),s.jsxs("div",{className:"parking-price mt-1",children:["â‚¹",e.totalAmount]})]})]}),s.jsxs("div",{className:"grid grid-4 mt-2",style:{fontSize:"0.9rem"},children:[s.jsxs("div",{children:[s.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Reference"}),s.jsx("div",{children:e.bookingReference})]}),s.jsxs("div",{children:[s.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Start"}),s.jsx("div",{children:new Date(e.startDateTime).toLocaleString()})]}),s.jsxs("div",{children:[s.jsx("small",{style:{color:"var(--color-text-muted)"},children:"End"}),s.jsx("div",{children:new Date(e.endDateTime).toLocaleString()})]}),s.jsxs("div",{children:[s.jsx("small",{style:{color:"var(--color-text-muted)"},children:"Vehicle"}),s.jsx("div",{children:e.vehicleNumber||"Not specified"})]})]}),s.jsxs("div",{className:"flex gap-1 mt-2",children:[e.status===6&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn btn-primary",onClick:()=>P(e.id,e.totalAmount),disabled:C===e.id,children:C===e.id?"Processing...":`Pay â‚¹${e.totalAmount}`}),s.jsx("button",{className:"btn btn-danger",onClick:()=>y(e.id),disabled:o===e.id,children:o===e.id?"Cancelling...":"Cancel"})]}),e.status===1&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn btn-primary",onClick:()=>w(e.id),children:"Check In"}),s.jsx("button",{className:"btn btn-danger",onClick:()=>y(e.id),disabled:o===e.id,children:o===e.id?"Cancelling...":"Cancel"})]}),e.status===2&&s.jsx("button",{className:"btn btn-primary",onClick:()=>b(e.id),children:"Check Out"}),e.status===0&&s.jsx("button",{className:"btn btn-danger",onClick:()=>y(e.id),disabled:o===e.id,children:o===e.id?"Cancelling...":"Cancel"}),s.jsx(N,{to:`/parking/${e.parkingSpaceId}`,className:"btn btn-secondary",children:"View Parking"})]})]},e.id))})]})})}export{O as default};
