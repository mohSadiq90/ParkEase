import{r as o,e as O,c as d,h as p,j as e,L as _}from"./index-B2BqGpJW.js";import{s as i}from"./toast-DJ39ryeq.js";import{S as G,I as W}from"./indianStatesCities-CpLRmfdt.js";const I=["Open","Covered","Garage","Street","Underground"],Y="https://parkeaseapp.azurewebsites.net",K=["booking.requested","payment.completed","booking.cancelled","booking.checkin","booking.checkout"];function Z(){const[b,P]=o.useState([]),[D,L]=o.useState(!0),[h,y]=o.useState(!1),[m,x]=o.useState(null),[f,N]=o.useState(null),[F,C]=o.useState(""),[A,E]=o.useState([]),{subscribeToRefresh:S}=O(),v={title:"",description:"",address:"",city:"",state:"",country:"India",postalCode:"",latitude:"",longitude:"",parkingType:0,totalSpots:10,hourlyRate:50,dailyRate:400,weeklyRate:2500,monthlyRate:8e3,is24Hours:!0,amenities:"",specialInstructions:""},[a,l]=o.useState(v),c=o.useCallback(async()=>{try{const s=await d.getMyListings();s.success&&s.data&&P(s.data)}catch(s){i.error(p(s,"Failed to load listings"))}L(!1)},[]),u=o.useCallback(async()=>{try{const s=await d.getVendorBookings();s.success&&s.data?.bookings&&E(s.data.bookings)}catch(s){console.error("Fetch bookings error:",s)}},[]);o.useEffect(()=>{c(),u()},[c,u]),o.useEffect(()=>S("VendorListings",K,()=>{console.log("ðŸ”„ VendorListings: Auto-refreshing due to notification"),c(),u()}),[S,c,u]);const B=s=>{const t=new Date,r=[0,1,2,6,"Pending","Confirmed","InProgress","AwaitingPayment"];return A.filter(n=>n.parkingSpaceId===s&&r.includes(n.status)&&new Date(n.endDateTime)>t).sort((n,g)=>new Date(n.startDateTime)-new Date(g.startDateTime))},$=s=>({0:"Pending",1:"Confirmed",2:"InProgress",6:"AwaitingPayment"})[s]||s,z=s=>{const t=s===1||s==="Confirmed",r=s===2||s==="InProgress";return{background:t?"rgba(16,185,129,0.2)":r?"rgba(234,179,8,0.2)":"rgba(107,114,128,0.2)",color:t?"#10b981":r?"#eab308":"#9ca3af"}},k=s=>{const t=new Date(s);return t.toLocaleDateString("en-IN",{day:"numeric",month:"short"})+" "+t.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})},U=async s=>{s.preventDefault();const t={...a,latitude:parseFloat(a.latitude)||0,longitude:parseFloat(a.longitude)||0,totalSpots:parseInt(a.totalSpots),hourlyRate:parseFloat(a.hourlyRate),dailyRate:parseFloat(a.dailyRate),weeklyRate:parseFloat(a.weeklyRate),monthlyRate:parseFloat(a.monthlyRate),parkingType:parseInt(a.parkingType),amenities:a.amenities?a.amenities.split(",").map(r=>r.trim()):[]};try{let r;m?r=await d.updateParking(m,t):r=await d.createParking(t),r.success?(i.success(m?"Listing updated successfully!":"Listing created successfully!"),y(!1),x(null),l(v),c()):i.error(r.message||"Operation failed")}catch(r){i.error(p(r,"Failed to save listing"))}},q=s=>{l({...s,amenities:s.amenities?.join(", ")||""}),x(s.id),y(!0)},M=async s=>{if(window.confirm("Are you sure you want to delete this listing?"))try{const t=await d.deleteParking(s);t.success?(i.success("Listing deleted successfully!"),c()):i.error(t.message||"Delete failed")}catch(t){i.error(p(t,"Failed to delete listing"))}},w=async(s,t)=>{if(!(!t||t.length===0)){N(s),C("Uploading...");try{const r=await d.uploadParkingFiles(s,Array.from(t));if(r.success){const n=r.data.urls.length;i.success(`${n} file(s) uploaded successfully!`),r.data.errors?.length>0&&i.error(`Some files skipped: ${r.data.errors.join(", ")}`),c()}else i.error(r.message||"Upload failed")}catch(r){i.error(p(r,"Failed to upload files"))}N(null),C("")}},V=async(s,t)=>{if(!window.confirm("Delete this image?"))return;const r=t.split("/").pop();try{const n=await d.deleteParkingFile(s,r);n.success?(i.success("File deleted"),c()):i.error(n.message||"Delete failed")}catch(n){i.error(p(n,"Failed to delete file"))}},H=async()=>{if(a.postalCode&&a.postalCode.length<6){i.error("Postal code must be 6 digits");return}if(a.postalCode.length===6)try{const t=await(await fetch(`https://api.postalpincode.in/pincode/${a.postalCode}`)).json();if(t&&t[0]&&t[0].Status==="Success"){const r=t[0].PostOffice[0],n=r.State,g=r.District;if(n!==a.state){i.error(`Postal code belongs to ${n}, not ${a.state}`),l(j=>({...j,postalCode:""}));return}const R=a.city.toLowerCase(),T=g.toLowerCase();if(!T.includes(R)&&!R.includes(T)){i.error(`Postal code belongs to ${g}, not ${a.city}`),l(j=>({...j,postalCode:""}));return}i.success("Postal code verified")}else i.error("Invalid Postal Code"),l(r=>({...r,postalCode:""}))}catch(s){console.error("PIN verification failed:",s)}};return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex-between mb-3",children:[e.jsx("h1",{children:"My Parking Listings"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{l(v),x(null),y(!h)},children:h?"Cancel":"+ Add Listing"})]}),h&&e.jsxs("div",{className:"card mb-3",children:[e.jsx("h3",{className:"card-title mb-2",children:m?"Edit Listing":"Create New Listing"}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid grid-2",style:{gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Title *"}),e.jsx("input",{type:"text",className:"form-input",value:a.title,onChange:s=>l({...a,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Parking Type"}),e.jsx("select",{className:"form-select",value:a.parkingType,onChange:s=>l({...a,parkingType:s.target.value}),children:I.map((s,t)=>e.jsx("option",{value:t,children:s},t))})]})]}),e.jsxs("div",{className:"form-group mt-1",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-input",rows:"3",value:a.description,onChange:s=>l({...a,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-4",style:{gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Address *"}),e.jsx("input",{type:"text",className:"form-input",value:a.address,onChange:s=>l({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",style:{display:"block",marginBottom:"0.5rem"},children:"State *"}),e.jsxs("select",{className:"form-select",style:{width:"100%"},value:a.state,onChange:s=>{const t=s.target.value;l({...a,state:t,city:""})},required:!0,children:[e.jsx("option",{value:"",children:"Select State"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",style:{display:"block",marginBottom:"0.5rem"},children:"City *"}),e.jsxs("select",{className:"form-select",style:{width:"100%"},value:a.city,onChange:s=>l({...a,city:s.target.value}),required:!0,disabled:!a.state,children:[e.jsx("option",{value:"",children:"Select City"}),a.state&&W[a.state]?.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",style:{display:"block",marginBottom:"0.5rem"},children:"Postal Code *"}),e.jsx("input",{type:"text",className:"form-input",style:{width:"100%"},value:a.postalCode,onChange:s=>{const t=s.target.value;/^\d{0,6}$/.test(t)&&l({...a,postalCode:t})},onBlur:H,required:!0,placeholder:"6 digits"})]})]}),e.jsxs("div",{className:"grid grid-4 mt-1",style:{gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Total Spots *"}),e.jsx("input",{type:"number",className:"form-input",value:a.totalSpots,onChange:s=>l({...a,totalSpots:s.target.value}),required:!0,min:"1"})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Hourly Rate (â‚¹) *"}),e.jsx("input",{type:"number",className:"form-input",value:a.hourlyRate,onChange:s=>l({...a,hourlyRate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Daily Rate (â‚¹) *"}),e.jsx("input",{type:"number",className:"form-input",value:a.dailyRate,onChange:s=>l({...a,dailyRate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Monthly Rate (â‚¹) *"}),e.jsx("input",{type:"number",className:"form-input",value:a.monthlyRate,onChange:s=>l({...a,monthlyRate:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"form-group mt-1",children:[e.jsx("label",{className:"form-label",children:"Amenities (comma-separated)"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"CCTV, Security, Covered, EV Charging",value:a.amenities,onChange:s=>l({...a,amenities:s.target.value})})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.is24Hours,onChange:s=>l({...a,is24Hours:s.target.checked})}),"24/7 Available"]})}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:m?"Update Listing":"Create Listing"})]})]}),D?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):b.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ…¿ï¸"}),e.jsx("h3",{children:"No listings yet"}),e.jsx("p",{children:"Create your first parking listing to start earning"})]}):e.jsx("div",{className:"grid grid-2",children:b.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex-between",children:[e.jsx("h3",{className:"card-title",children:s.title}),e.jsx("span",{className:`parking-tag ${s.isActive?"":"inactive"}`,style:{background:s.isActive?"rgba(16, 185, 129, 0.2)":"rgba(107, 114, 128, 0.2)"},children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"parking-location",children:["ðŸ“ ",s.address,", ",s.city]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:"parking-tag",children:I[s.parkingType]}),e.jsxs("span",{className:"parking-tag",children:[s.totalSpots," spots"]}),e.jsxs("span",{className:"rating",children:["â­ ",s.averageRating?.toFixed(1)||"New"]})]}),e.jsxs("div",{className:"parking-price mt-1",children:["â‚¹",s.hourlyRate,e.jsx("span",{children:"/hr"})]}),(()=>{const t=B(s.id);return t.length===0?null:e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"rgba(59, 130, 246, 0.1)",borderRadius:"var(--radius-sm)",border:"1px solid rgba(59, 130, 246, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"ðŸ“…"}),e.jsxs("strong",{style:{color:"var(--color-primary)",fontSize:"0.85rem"},children:["Active Reservations (",t.length,")"]})]}),e.jsxs("div",{style:{maxHeight:"180px",overflowY:"auto"},children:[t.slice(0,5).map(r=>e.jsxs("div",{style:{padding:"0.5rem",marginBottom:"0.4rem",background:"rgba(0,0,0,0.2)",borderRadius:"6px",fontSize:"0.8rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.3rem"},children:[e.jsx("span",{style:{padding:"2px 6px",borderRadius:"4px",fontSize:"0.7rem",...z(r.status)},children:$(r.status)}),e.jsxs("span",{style:{color:"var(--color-text-muted)",fontSize:"0.75rem"},children:[k(r.startDateTime)," â†’ ",k(r.endDateTime)]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"0.3rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{style:{fontSize:"0.85rem"},children:"ðŸ‘¤"}),e.jsx("span",{style:{fontWeight:"500"},children:r.userName||"Unknown"})]}),r.vehicleNumber&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{style:{fontSize:"0.85rem"},children:"ðŸš—"}),e.jsx("span",{children:r.vehicleNumber}),r.vehicleModel&&e.jsxs("span",{style:{color:"var(--color-text-muted)"},children:["(",r.vehicleModel,")"]})]})]})]},r.id)),t.length>5&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--color-text-muted)",paddingTop:"0.3rem"},children:["+",t.length-5," more..."]})]})]})})(),s.imageUrls&&s.imageUrls.length>0&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("small",{style:{color:"var(--color-text-muted)"},children:["Images (",s.imageUrls.length,")"]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginTop:"0.5rem"},children:s.imageUrls.map((t,r)=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:`${Y}${t}`,alt:`Parking ${r+1}`,style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"var(--radius-sm)",cursor:"pointer"},loading:"lazy"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),V(s.id,t)},style:{position:"absolute",top:"-6px",right:"-6px",width:"18px",height:"18px",borderRadius:"50%",background:"#ef4444",color:"white",border:"none",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:"Ã—"})]},r))})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"block",padding:"0.75rem",border:"2px dashed var(--color-border)",borderRadius:"var(--radius-sm)",textAlign:"center",cursor:f===s.id?"wait":"pointer",transition:"border-color 0.2s",background:"rgba(99, 102, 241, 0.05)"},onDragOver:t=>{t.preventDefault(),t.currentTarget.style.borderColor="var(--color-primary)"},onDragLeave:t=>{t.currentTarget.style.borderColor="var(--color-border)"},onDrop:t=>{t.preventDefault(),t.currentTarget.style.borderColor="var(--color-border)",w(s.id,t.dataTransfer.files)},children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/jpeg,image/png,image/webp,video/mp4,video/webm",style:{display:"none"},onChange:t=>w(s.id,t.target.files),disabled:f===s.id}),f===s.id?e.jsxs("span",{children:["â³ ",F]}):e.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:"0.85rem"},children:"ðŸ“· Drop images/videos or click to upload"})]}),e.jsx("small",{style:{color:"var(--color-text-muted)",display:"block",marginTop:"0.25rem"},children:"Max: 5MB images, 50MB videos"})]}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>q(s),children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>M(s.id),children:"Delete"}),e.jsx(_,{to:`/parking/${s.id}`,className:"btn btn-outline",children:"View"})]})]},s.id))})]})})}export{Z as default};
